<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X va 0 – AI bilan (Neon Stili)</title>
    <style>
        /* NEON RANG PALITRASI */
        :root {
            --bg-color: #1a1a2e; /* Dark Blue/Black */
            --cell-bg: #2b3a55;
            --x-color: #ff33cc; /* Neon Pink */
            --o-color: #00ccff; /* Neon Cyan */
            --win-color: #66ff66; /* Neon Green */
            --shadow-x: 0 0 15px var(--x-color);
            --shadow-o: 0 0 15px var(--o-color);
            --shadow-win: 0 0 20px var(--win-color);
            --shadow-text: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px var(--win-color);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: #e0e0e0;
            text-align: center;
            margin: 0;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 400px; /* Mobilga moslash uchun kichikroq max-width */
            margin: 10px auto;
            background: #111827; /* Slightly lighter inner dark color */
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(0, 204, 255, 0.3); /* Umumiy yorqinlik */
            border: 2px solid #00ccff;
        }
        h1 {
            color: var(--o-color);
            text-shadow: var(--shadow-o);
            margin-bottom: 5px;
            font-size: 2em;
        }
        .info {
            font-size: 0.9em;
            color: #90a4ae;
            margin-bottom: 20px;
        }
        
        /* O'YIN DOSKASI */
        #board {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Fluid columns */
            gap: 10px;
            margin: 25px auto;
            width: 100%;
            max-width: 350px; /* Board max size */
        }
        .cell {
            aspect-ratio: 1/1; /* Har doim kvadrat */
            background: var(--cell-bg);
            border: 2px solid #00ccff;
            border-radius: 10px;
            font-size: 3em; /* Mobilga mos katta yozuv */
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 5px rgba(0, 204, 255, 0.2);
        }
        .cell:hover {
            background: #3c4a62;
            border-color: var(--win-color);
        }
        
        .cell.x { 
            color: var(--x-color); 
            text-shadow: var(--shadow-x);
        }
        .cell.o { 
            color: var(--o-color); 
            text-shadow: var(--shadow-o);
        }
        .cell.winning {
            background: var(--win-color);
            color: var(--bg-color);
            text-shadow: none;
            box-shadow: var(--shadow-win);
            animation: neonPulse 1s infinite alternate;
            border-color: var(--win-color);
        }
        @keyframes neonPulse {
            0% { box-shadow: var(--shadow-win); }
            100% { box-shadow: 0 0 10px var(--win-color), 0 0 30px var(--win-color); }
        }

        /* NAZORAT ELEMENTLARI */
        .controls {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap; /* Mobil uchun pastga tushadi */
            justify-content: center;
            gap: 10px;
        }
        select, button {
            padding: 12px 18px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
            background: #3c4a62;
            color: #e0e0e0;
            border: 2px solid #5a6b8c;
            appearance: none; /* Select uchun standart uslublarni o'chirish */
        }
        select:focus, button:focus {
            outline: none;
            border-color: var(--o-color);
            box-shadow: 0 0 8px var(--o-color);
        }
        button {
            background: var(--x-color);
            color: var(--bg-color);
            border: 2px solid var(--x-color);
            text-shadow: none;
            box-shadow: var(--shadow-x);
        }
        button:hover {
            background: #e729b4;
            box-shadow: 0 0 10px var(--x-color), 0 0 20px var(--x-color);
        }

        #status {
            margin: 15px 0;
            font-weight: bold;
            font-size: 1.3em;
            min-height: 30px;
            text-shadow: var(--shadow-text);
        }
        .hidden { display: none !important; }

        /* Mobil qurilmalar uchun kichik tuzatishlar */
        @media (max-width: 450px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            h1 {
                font-size: 1.5em;
            }
            .controls {
                flex-direction: column; /* Mobil ekranlarda elementlar ustma-ust tushadi */
                gap: 8px;
            }
            select, button {
                width: 100%;
                box-sizing: border-box;
                padding: 10px;
            }
            #board {
                max-width: 90vw;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>X va 0 (NEON)</h1>
    <p class="info">Siz — X (Pushti), AI — O (Moviy)</p>

    <div class="controls">
        <select id="difficulty">
            <option value="1">1 - Oson</option>
            <option value="2">2 - Qiyin</option>
            <option value="3" selected>3 - Juda qiyin (Minimax)</option>
        </select>

        <select id="first">
            <option value="h">Men birinchi (X)</option>
            <option value="y">AI birinchi (O)</option>
        </select>

        <button id="start">Boshlash</button>
        <button id="restart" class="hidden">Yana o‘ynash</button>
    </div>

    <div id="board" class="hidden"></div>
    <div id="status">Tanlang va boshlang!</div>
</div>

<script>
    // === O'YIN O'ZGARUVCHILARI ===
    let board = Array(9).fill(' ');
    let currentPlayer = 'X';
    let gameActive = false;
    let difficulty = '3';
    let playerFirst = true;

    const WIN_COMBINATIONS = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
    ];

    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('start');
    const restartBtn = document.getElementById('restart');
    const diffSelect = document.getElementById('difficulty');
    const firstSelect = document.getElementById('first');

    // === DOSKA CHIZISH ===
    function printBoard() {
        boardEl.innerHTML = '';
        board.forEach((cell, i) => {
            const div = document.createElement('div');
            div.classList.add('cell');
            if (cell === 'X') div.classList.add('x');
            if (cell === 'O') div.classList.add('o');
            div.textContent = cell === ' ' ? '' : cell;
            div.dataset.index = i;
            div.addEventListener('click', handleClick);
            boardEl.appendChild(div);
        });
    }

    // === G'OLIB TEKSHIRISH VA MANTIQ FUNKSIYALARI ===
    function getWinningCombo(currentBoard) {
        for (const combo of WIN_COMBINATIONS) {
            if (currentBoard[combo[0]] !== ' ' &&
                currentBoard[combo[0]] === currentBoard[combo[1]] &&
                currentBoard[combo[0]] === currentBoard[combo[2]]) {
                return combo;
            }
        }
        return null;
    }

    function isWinner(player) {
        return WIN_COMBINATIONS.some(combo =>
            combo.every(i => board[i] === player)
        );
    }

    function isDraw() {
        return board.every(cell => cell !== ' ');
    }

    function availableMoves() {
        return board.map((cell, i) => cell === ' ' ? i : null).filter(v => v !== null);
    }

    // === AI: OSON ===
    function aiEasy() {
        const moves = availableMoves();
        return moves[Math.floor(Math.random() * moves.length)];
    }

    // === AI: QIYIN (Bloklash/Yutish/Markaz) ===
    function aiHard() {
        // 1. Yutish (O)
        for (const move of availableMoves()) {
            board[move] = 'O';
            if (isWinner('O')) { board[move] = ' '; return move; }
            board[move] = ' ';
        }
        // 2. Bloklash (X)
        for (const move of availableMoves()) {
            board[move] = 'X';
            if (isWinner('X')) { board[move] = ' '; return move; }
            board[move] = ' ';
        }
        // 3. Markaz
        if (availableMoves().includes(4)) return 4;
        // 4. Burchaklar
        const corners = [0, 2, 6, 8].filter(m => availableMoves().includes(m));
        if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
        // 5. Qolgan (Chekkalar)
        return aiEasy();
    }

    // === MINIMAX (MUKAMMAL AI) ===
    function minimax(currentBoard, isMaximizing) {
        // O: 10 (AI yutdi) | X: -10 (O'yinchi yutdi) | Durrang: 0
        const winningCombo = getWinningCombo(currentBoard);
        if (winningCombo) {
            return currentBoard[winningCombo[0]] === 'O' ? 10 : -10;
        }
        if (currentBoard.every(cell => cell !== ' ')) return 0; // Draw

        const moves = currentBoard.map((cell, i) => cell === ' ' ? i : null).filter(v => v !== null);

        if (isMaximizing) {
            let best = -Infinity;
            for (const move of moves) {
                currentBoard[move] = 'O';
                const score = minimax(currentBoard, false);
                currentBoard[move] = ' ';
                best = Math.max(best, score);
            }
            return best;
        } else {
            let best = Infinity;
            for (const move of moves) {
                currentBoard[move] = 'X';
                const score = minimax(currentBoard, true);
                currentBoard[move] = ' ';
                best = Math.min(best, score);
            }
            return best;
        }
    }

    function aiImpossible() {
        let bestScore = -Infinity;
        let bestMove = null;
        
        // board nusxasi minimaxga beriladi, chunki u boardni o'zgartiradi
        const tempBoard = [...board]; 

        for (const move of availableMoves()) {
            tempBoard[move] = 'O';
            const score = minimax(tempBoard, false);
            tempBoard[move] = ' '; 
            
            if (score > bestScore) {
                bestScore = score;
                bestMove = move;
            }
        }
        return bestMove;
    }

    // === AI YURISHI ===
    function makeAIMove() {
        if (!gameActive || currentPlayer !== 'O') return;

        let move;
        if (difficulty === '1') move = aiEasy();
        else if (difficulty === '2') move = aiHard();
        else move = aiImpossible();

        if (move !== null) {
            board[move] = 'O';
            printBoard();

            if (isWinner('O')) {
                highlightWinner();
                endGame("AI yutdi!", 'var(--o-color)');
            } else if (isDraw()) {
                endGame("Durrang!", '#90a4ae');
            } else {
                currentPlayer = 'X';
                statusEl.textContent = "Sizning navbatingiz (X)";
            }
        }
    }

    // === O'YINCHI YURISHI ===
    function handleClick(e) {
        const idx = +e.target.dataset.index;
        if (!gameActive || board[idx] !== ' ' || currentPlayer !== 'X') return;

        board[idx] = 'X';
        printBoard();

        if (isWinner('X')) {
            highlightWinner();
            endGame("Siz yutdingiz!", 'var(--x-color)');
        } else if (isDraw()) {
            endGame("Durrang!", '#90a4ae');
        } else {
            currentPlayer = 'O';
            statusEl.textContent = "AI o‘ylayapti...";
            // AI yurishini 500ms dan keyin boshlash
            setTimeout(makeAIMove, 500); 
        }
    }

    function highlightWinner() {
        const combo = getWinningCombo(board);
        if (combo) {
            combo.forEach(i => {
                const cell = boardEl.children[i];
                if (cell) cell.classList.add('winning');
            });
        }
    }

    function endGame(msg, color) {
        gameActive = false;
        statusEl.innerHTML = `<strong style="color:${color}; text-shadow: 0 0 10px ${color};">${msg}</strong>`;
        restartBtn.classList.remove('hidden');
    }

    // === YANGI O'YIN ===
    function startGame() {
        board = Array(9).fill(' ');
        difficulty = diffSelect.value;
        playerFirst = firstSelect.value === 'h';
        currentPlayer = playerFirst ? 'X' : 'O';
        gameActive = true;

        printBoard();
        boardEl.classList.remove('hidden');
        startBtn.classList.add('hidden');
        restartBtn.classList.add('hidden');

        statusEl.textContent = playerFirst
            ? "Siz birinchi (X)"
            : "AI boshladi...";

        if (!playerFirst) setTimeout(makeAIMove, 700);
    }

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', () => {
        startBtn.classList.remove('hidden');
        boardEl.classList.add('hidden');
        statusEl.textContent = "Yana o‘ynash uchun sozlamalarni tanlang va boshlang!";
    });

    // Birinchi marta ko‘rinish
    printBoard();
</script>

</body>
</html>